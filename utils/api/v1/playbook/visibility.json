{
  "in": "ASA-Config-initial-10_0-fw.xml",
  "out": "final.xml",
  "stagename": "share/visibility-",
  "header-comment": "*****************************************************************************************************************************************************\n*                                                                                                                                                   *\n*  This script makes all of the required changes to add 'Visibility' to your PAN-OS XML configuration file.                                         *\n*             (To achieve ‘Visibility’ the script can be used 'as is' without any changes).                                                         *\n*                                                                                                                                                   *\n*  This script will need you to only do the following two things;                                                                                   *\n*    i) Rename the input file referenced in the first pan-os-php command below to be the XML configuration file being used (eg: example_panos.xml). *\n*    ii) Copy the input file from the above (ie: example_panos.xml) to the pan-os-php staging directory so that it can be referenced by this script.*\n*                                                                                                                                                   *\n*****************************************************************************************************************************************************\n\n*****************************************************************************************************************************************************\n*                                                                                                                                                   *\n*  The script will now begin and will run a sequence of pan-os-php commands.                                                                        *\n*  Each new command will use the outputfile of the previous command as the input file of the new command.                                           *\n*  The final xml file generated by the last command in this script should then be imported, and then loaded into the PAN-OS firewall.               *\n*                                                                                                                                                   *\n*****************************************************************************************************************************************************",
  "footer-comment": "*****************************************************************************************************************************************************\n*                                                                                                                                                   *\n*   VISIBILITY playbook FINALISED                                                                                                                   *\n*                                                                                                                                                   *\n*****************************************************************************************************************************************************",
  "command": [
    {
      "type": "ironskillet-update",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The first pan-os-php command (below) will download snippets to the pan-os-php folder from github.            *\n*  This ensures the latest snippets from https://github.com/PaloAltoNetworks/iron-skillet will be used below.   *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "device",
      "actions": "actions=logforwardingprofile-create-bp",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The next pan-os-php command (below) will create the Best Practice Log Forwarding Profile called 'default'.   *\n*  This config is sourced from the relevant snippet on https://github.com/PaloAltoNetworks/iron-skillet.        *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "device",
      "actions": "actions=sp_spg-create-alert-only-bp",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The next pan-os-php command (below) will create the Best Practice Security Profiles called 'Alert-Only-XX'.  *\n*  (ie; 'Alert-Only-AS',' Alert-Only-AV','Alert-Only-FB','Alert-Only-URL','Alert-Only-VP','Alert-Only-WF')      *\n*                                                                                                               *\n*  This command will also create the Best Practice Security Profile Group called 'Alert-Only'.                  *\n*  This config is sourced from the relevant snippets on https://github.com/PaloAltoNetworks/iron-skillet.       *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "device",
      "actions": "actions=zoneprotectionprofile-create-bp",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The next pan-os-php command (below) will create the Best Practice Zone Protection Profile called             *\n*  'Recommended_Zone_Protection’.                                                                               *\n*  This config is sourced from the relevant snippet on https://github.com/PaloAltoNetworks/iron-skillet.        *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "zone",
      "actions": "actions=zpp-Set:Recommended_Zone_Protection",
      "filter": "filter=!(zpp is.set)",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The next pan-os-php command (below) will set the Best Practice Zone Protection Profile to all zones'.        *\n*  This config is sourced from the relevant snippet on https://github.com/PaloAltoNetworks/iron-skillet.        *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "zone",
      "actions": "actions=logSetting-Set:default",
      "filter": "filter=!(logprof is.set)",
      "comment": "*****************************************************************************************************************\n*                                                                                                               *\n*  The next pan-os-php command (below) will set the Best Practice Log Foprwarding Profile to all zones'.        *\n*  This config is sourced from the relevant snippet on https://github.com/PaloAltoNetworks/iron-skillet.        *\n*                                                                                                               *\n*****************************************************************************************************************"
    },
    {
      "type": "rule",
      "actions": "actions=logsetting-set:default",
      "filter": "filter=!(logprof is.set)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Group-Set:Alert-Only",
      "filter": "filter=!(secprof is.set) and (action is.allow)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:vulnerability,Alert-Only-VP",
      "filter": "filter=(secprof type.is.profile) and !(secprof vuln-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:spyware,Alert-Only-AS",
      "filter": "filter=(secprof type.is.profile) and !(secprof as-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:virus,Alert-Only-AV",
      "filter": "filter=(secprof type.is.profile) and !(secprof av-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:url-filtering,Alert-Only-URL",
      "filter": "filter=(secprof type.is.profile) and !(secprof url-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:file-blocking,Alert-Only-FB",
      "filter": "filter=(secprof type.is.profile) and !(secprof file-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Profile-Set:wildfire,Alert-Only-WF",
      "filter": "filter=(secprof type.is.profile) and !(secprof wf-profile.is.set) and (action is.allow) and !(rule is.disabled)"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:virus,Alert-Only-AV",
      "filter": "filter=!(secprof av-profile.is.set )"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:vulnerability,Alert-Only-VP",
      "filter": "filter=!(secprof vuln-profile.is.set )"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:url-filtering,Alert-Only-URL",
      "filter": "filter=!(secprof url-profile.is.set )"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:file-blocking,Alert-Only-FB",
      "filter": "filter=!(secprof file-profile.is.set )"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:spyware,Alert-Only-AS",
      "filter": "filter=!(secprof as-profile.is.set )"
    },
    {
      "type": "securityprofilegroup",
      "actions": "actions=securityprofile-set:wildfire,Alert-Only-WF",
      "filter": "filter=!(secprof wf-profile.is.set )"
    },
    {
      "type": "rule",
      "actions": "actions=securityProfile-Remove",
      "filter": "filter=(secprof is.set) and !(action is.allow)"
    },
    {
      "type": "rule",
      "actions": "actions=logend-Enable"
    },
    {
      "type": "device",
      "actions": "actions=defaultsecurityrule-logend-enable"
    },
    {
      "type": "device",
      "actions": "actions=defaultsecurityrule-logsetting-set:default,false"
    },
    {
      "type": "device",
      "actions": "actions=defaultsecurityrule-securityprofile-remove:false"
    }
  ]
}